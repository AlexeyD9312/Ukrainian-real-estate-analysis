# Аналіз ринку нерухомості України
## Цілі проекту
Аналіз  риноку житлової нерухомості України. Дослідити динаміку цін та кількості пропозицій на ринку за останні 7 років. Оцінити стан ринку на даний момент. Розглянути інвестиційну привабливість нерухомості в Украіні. Дослідити, на прикладі м.Дніпро, яка саме нерухомість найбільш цікава покупцям на даний момент.

## Опис проекту
Основним джерелом данних для нас буде слугувати найбільший та найпоширеніший сайт з продажу нерухомості в Україні - DIM.RIA. Використовуючи API сайту, та  парсинг HTML сторінки, будемо проводити збір та очищення данних  за допомогою Python. Зберігання та сортування данних буде проходити у реляційній базі даних MySQL, візуалізація та аналіз у PowerBi.
## Структура проекту
В основному описі проекту для прикладу будуть наведені  частини скриптів, JSON файлів та інших даних, які будуть посилатись на файли всередині репозиторію. Для більш детального розбору коду,змісту та структури файлу, можна буде перейти за посилянням.
## Збір даних.
Перша частина нашої роботи передбачає обробку середньої ціни нерухомості по містам України. Витягувати ці дані ми будемо за допомогою API DIM.RIA, використовуючі Python, бібліотеку Request. Обов'язково ознайомлюємося з документацією АПІ, обираємо потрібні нам параметри та робимо запит. Наведемо приклад. [Основний код](./pyton_scripts/AVG_sale_all_city.py)
```python URL = "https://developers.ria.com/dom/average_price"
    params["api_key"] = api_key
    params = {

            "category": 1,
            "sub_category": 2,
            "operation": 1,  #3 rent
            "city_id": city_id,
            "date_from": date_from_str,
            "date_to": date_to_str
        }
    city_ids = [1,2,3,4,5,6,7,8,9,10,12,14,15,16,18,19,20,22,23,24,25]
    start_date = datetime(2017,6,1)
    end_date = datetime(2025,3,1)
    squares = [40,50,60,70,80,90,100]
    pause = 2.5
```

Це частина стандартнго запиту, в якому вказані параметри, ключ та URL. Відповідь буде дана у вигляді JSON файлу[Приклад відповіді](./data/1AVG_PRICE_SALE_RENT.json), з зазначеною вартістю нерухомості та кількістю об'єктів. Це корисна інформація, але для оцінку вартості нерухомості дуже важливо мати ціну за 1 квадратний метр. Тому ми будемо окремо робити запити на кожну задану площу(була взята вибірка найбільш популярних площ квартир).У подальшому отримана ціна  буде поділена на площу вказану у запиті. Це дозволить в кінці вирахувати середню вартість за метр, по кожному місту, в діапазоні заданих дат. Категорії відповідають за тип нерухомості - це житлова нерухомість, саме квартири.
Операція - продаж. Також додаємо дату початку та дату кінця дослідження, інтервал запиту - 1 місяць. Формуємо список з ID міст.  Та не забуваємо про паузи між запитами, адже даний сервіс має обмеження в 2000 запитів на годину.
В кінці, за допомогою бібліотеки Pandas, ми отримаємо наступний CSV файл по кожному місту.[Приклад файлу](./data/AVG_price_city_Kiyiv.csv)
```md
date_from,date_to,count,avg_price,price_per_sqm_40,price_per_sqm_50,price_per_sqm_60,price_per_sqm_70,price_per_sqm_80,price_per_sqm_90,price_per_sqm_100,avg_sqm_price
2017-06-01,2017-07-01,8284,1672774.839,24214.65925,28272.2508,26614.31016666667,27673.896285714287,29450.26125,31995.345555555556,34031.413,28893.162329705217
2017-07-01,2017-08-01,9492,1731265.93,24547.8005,26873.3816,27993.105833333335,27673.896285714287,33704.187875,31995.345555555556,35917.3081,29815.003678514742
2017-08-01,2017-09-01,9594,1679586.35,24547.8005,26455.03,28105.902250000003,27316.34942857143,33168.7585625,38759.685,39417.9947,31110.217205867346
2017-09-01,2017-10-01,8913,1617250.8,24140.214874999998,26415.096400000002,27777.7815,26077.101000000002,33876.788062499996,39682.545000000006,36772.4917,30677.43121964286
2017-10-01,2017-11-01,4417,1617250.8,23584.9075,25471.7001,26504.94366666667,26184.06057142857,34366.5795,36238.39755555556,34097.0377,29492.518084807256
2017-11-01,2017-12-01,5473,1532033.25,26462.392499999998,28969.355999999996,25301.761249999996,25069.635,33600.274687499994,27700.399166666666,36944.285445,29149.729149880954
```

Такий самий запит повторимо і по аренді, але без запитів по квадратних метрах. Для нашого дослідження цього буде достатньо. Також додатково додаємо дані курсу валют, а саме гривні до доллару, за весь період дослідження, для відображення цін на графіку. 
Отримані дані завантажуємо до Pover Bi, де ми і будемо робити візуалізацію та аналіз середньої вартості житлової нерухомості.

## Візуалізація та аналіз
---

![image Alt Text](./vizualization/images_2.bmp)
---

Для візуалізації даних застосовуємо лінійно - стовпчатий графік. Лінійний графік відображає ціну, стовпчатий - кількість пропозицій на ринку.
Одразу кидається в очі розрив у графіку на початку 2022 року, це пов'язано з початком бойових дій на территорії України, та згортання ринку нерухомості через закриття реєстрів нерухомості. Після відновлення роботи реєстрів,  ми спостерігаємо невелику анамомалію у вигляді стрибка цін на короткий період. Це було викликано штучно, через "надування" цін у деяких містах, але ринок це швидко виправляє і на початку осені 2022 року ми бачимо нормалізацію ринку і цін.
Далі до весни 2024 року ми бачимо постійне зростання цін, майже на 30%, і корельване зростання кількості пропозицій. Зростання кількості пропозицій я пов'язую з міграційним фактором, адже багато людей покинули територію України, та вирішили продати своє житло. Також хочу акцентувати увагу, що уількість пропозицій - це не кількість реальних угод, інформації по кількості угод немає у відкритому доступі, цю проблему ми будемо намагатися мінімізувати у майбутньому.   

А от зростанням ціни - питання більш складне. Лідируючий сегмент у формуванні цін на ринку нерухомості - ринок первинного житла. За останні 3 роки ми можемо спостерігати постійне зростання цін на сировину та будівельні матеріали, в залежності від сегменту, від 40 до 80 %. Цей фактор змушує забудовників збільшувати ціну за свої об'єкти, тягнучи за собою весь ринок. У якості експеременту додамо графік вартості нерухомості у еквіваленті золота, адже відсоткове здорожчання золота добре корелює зі здорожченням вартості будівельних матеріалів.

![image Alt Text](./vizualization/images_3.bmp)
---

Тобто покупці спостерігають зростання цін на нерухомості у долларі. Продавці, в свою чергу, розуміючи реальну собіварть об'єктів, відмовляються стримувати зростання цін, що призводить до різкого скорочення кількості нових об'єктів,вимушене зниження цін, та стагнації ринку уцілому.

Далі коротко оглянемо динаміку цін на оренду нерухомості.

![image Alt Text](./vizualization/images_4.bmp)
---

Тут ми бачимо доволі виражену аномалію , у вигляді значного зростання цін на оренду житлової нерухомості, у період 2021 - початку 2022 року. В основному це пов'язано з двома містами - Київ та Одесса. Адже у довоєнний перід САРЕДНЯ вартість нерухомості у Києві складала 65000 грн, а у Одессі, у літній період, доходила до 35000 грн. (Згідно даних з нашого ресурсу!) Звісно таких середніх цін на оренду , після початку бойових дій, ми не спостерігаємо. В іншому , після лютого 2022 року, зростання цін на оренду у західних регіонах, збалансувалось зниженням цін у східних, та збільшенням кількості пропозицій уцілому, через міграційні процеси. Далі ми бачимо доволі сталу та прогнозовану динаміку зростання, через інфляційні поцеси, та сезонні коливання.

Далі розглянемо дашборд з мапою України, на якому буде зображена середня вартість нерухомості, візуалізована кількість пропозицій, та середній строк окупності, якій ми отримали поділивши середню вартість об'єкта на середню вартість оренди. Оберемо період за останні 5 років.

![image Alt Text](./vizualization/map.bmp)
---

Одразу спостерігаємо найбільший показник кількості об'єктів у Києві та Одессі, який значно , у рази перевищує об'єм ринку інших міст України.
Звісно, стосовно Києва, прогнозовано що тут ми маємо бачити найбільшу кількість пропозицій, адже це столиця країни, з населенням близько 3х мільйонів.
Одесса , в свою чергу має населення близько 1 мільйона. Так це курортне місто, з гарним географічним положенням, але це не обгрунтовує таку велику кількість пропозицій на ринку. Можливо ринок нерухомості в Одессі значно "перегріли" забодувники, великою кількістю об'єктів, до яких додалася значна кількість, через міграційний фактор, об'єктів вторинного ринку нерухомості, що призвело аномального зростання об'єму житлового ринку нерухомості у Одессі.

Далі ми мижемо розглянути показник кожного міста окремо, додавши міри з відсотковою зміною цін у долларі та золоті, за вказаний період.
Для прикладу розглянемо місто Київ.

![image Alt Text](./vizualization/map_2.bmp)
---

Ми спостерігаємо середню вартість житла в районі 1700$ за метр. Середній строк окупності, від здачі в оренду, складає трохи більше 11 років, що є досить непогано.
Також ми бачимо загальне зростання ціни у долларі, за останні 5 років, на 4.25%, та зниження вартості, відносно золота, тобто реальної собівартості квартир, на 38%.
Звісно останній показник - експерементальний, але він відображає інфляційні процесси долара відносно вартості сировини, будівельних матеріалів.

На цьому єтапі ми можемо дослідити динаміку цін у кожному обласному центрі України, оцінити інвестиційну привабливість нерухомості, як для продавця так і для покупця. Прогнозовано, що нерухомість у містх на сході втратила свою вартість. В той час як на заході- навпаки ціна виросла. До цього додається строк окупності від оренди та ризики пов'язані з бойовими діями. За сукупністі цих факторів можна розглянути інвестиційну привабливість, стан ринку, для прийняття рішень з покупки або продажу житлової нерухомості.

Раніше у роботі вже підіймалося питання про відсутність показніка кількості  реальних угод з продажу квартир. Нажаль ці дані відсутні у відкритому доступі, що ускладнює реальну оцінку стану ринку нерухомості. Цю проблему ми спробуємо мінізувати у наступних кроках.

У цьому розділі ми будемо збирати інформацію по кожному об'єкту у місті Дніпро, формувати реляційну базу даних, та робити більш детальний аналіз ринку нерухомості, враховуючи характеристики кожного об'єкту.
Зробивши запит на конкретне ID оголошення сайту DIM.RIA, ми отримаємо відповідь в вигляді JSON файлу з подібним описом квартири, починаючи від локації, фізичних характепистик квартири, закінчуючи інформацією про продавця. Тож розглянемо процесс отримання цих даних.

Робимо API запит, на отримання ID об'єктів за наступними параметрами: категорія - квартири, операція - продаж, ID області та міста Дніпро. Також додався параметр сторінки, адже сервіс видає інформацію не більше ніж 100 ID за запит.
```python
API_KEY = "tBpXw0JFJHFL5gbyB0h1WP6ax6ZpmtnjhsQrVXgf"
URL = "https://developers.ria.com/dom/search"
params = {
    "api_key": API_KEY,
    "category":1,
    "operation":1,
    "state_id":11,
    "city_id":11,
    "page":0
}
```
 [Повний код](./pyton_scripts/oll_Dnipro_ID.py)

 У відповідь ми отримуємо JSON файл, який містить загальну кількість об'єктів та список із 100 ID цих об'єктів. [Файл](./data/Kiyiv_ID.json)
 По місту Дніпро ми маємо близько 7600 об'єктів. Тож робимо 76 запитів , та зберігаємо список із усіх ID по місту Дніпро одним файлом.

 Тепер робимо запит по кожному ID. [код запиту](./pyton_scripts/parce_all_obj_Dnipro.py)  ми отримуємо JSON файл з повним описом і характеристикою об'єкту. [Файл з характеристикою квартири](./data/0000_30429057_ID.json). Зберігаємо усі 7600 файлів в окрему папку.
 Вивчаємо документацію API, ключі словника, та починаємо виділяти та зберігати в окремі CSV файли  потрібнібні нам параметрами, для формування реляційної Бази Даних. Файл відповіді містить дуже багато інформації, з дуже розгалудженою системою ключів. Це дає нам змогу до формування дуже широкої БД. Наприклад ми маємо ID не тільки міст та обласей, а й районів,вулиць. Додатково є інформація про продавців. Дуже велика кількість фізичних характеристик, додаткових тегів, наприклад таких як вид з вікна, наявність та стан ремонту. Тобто, в теорії, у нас є змога формувати дуже широку,структуровану та розгалуджену базу. Але вичаючи та збираючи ці інформацію ми зтикаємося з дужу великою кількістю пропусків. Тому зібравши дуже велику кількість інформацію, ми зтикаємося з неможливістю іі використання у аналізі.  
 З прикладом збору інформації та іі зберігання можна детальніше ознайомитись тут  [Код](./pyton_scripts/general_characteristics_to_csv.py)   [Отриманий файл](./data/general_characteristics.csv) 

 Додатково кожний файл з характеристикою квартири має URL посилання на сторінку об'ви на сайті DIM.RIA. Перейшовши за цим посиланням, ми бачимо розміщення всіх характеристик, вказаних у нашому файлі, на сторінці сайту. Але також на сторінці сайту, у кожному оголошенні, ми маємо загаліну кількість переглядів користувачів, та додавань об'яв у обраний список користувача. Нажаль ці параметри не надаються у відповіді сервісу, адже ці дані дають нам змоги виявити реальну зацікавленість покупців у тому чи іншому об'єкті. Це дозволить нам частково компенсувати відсутність інформації по кількості угод у нашому аналізі. Тож починаємо збирати ці дані для кожного обєкту. Для цього використовуємо бібліотек Python BeautifulSoup, яка дозволяє нам парсити данні використовуючи HTML сторінки. Базова структура сторінки є статичною, це всі зазначені характеристики, а от кількість переглядів і додавань є динамічним контентом. Тому додатково долучаємо бібліотеку Selenium.
 Вона дозволить нам імітувати відвідування сайту користувачем, що дозволить нам зібрати потрібні дані. [Код з бібліотекою Selenium ](./pyton_scripts/views_added_for_pause.py)  Паралельно збираємо інші дані та отримуємо файл для нашої БД.  [Файл з кількістю переглядів](./data/Total_views_check.csv)
 
Всі отримані файли завантажуємо у БД MySQL , втановлюємо зв'язки через PRIMARY, Foreign key. Вказуємо типи даних стовпцій та отримуємо наступну схему.

![image Alt Text](./vizualization/mySQL.bmp)
---

Ми отримуємо 4 основні таблиці location, financial_information, phisikal_characteristics, realty_url_information. Ці таблиці мають однакові ключі та кількість рядків. По суті це одна таблиця, розділена на логічні складові: локація, фінансова інформація, фізичні характеристики, характеристики оголошення.
Таке розділення дало кращу читабельність, але виросла кількість зв'язків, що ускладнило процесс виконання запитів. Інші таблиці використовуються для зберігання довідкової інформації, яка зв'язана з основними таблицями по зовнішнім ключам.
Тож створюємо view, вказуючи потрібні нам характеристики(місто,район,ціни,площу,перегляди...) , та відсіюємо об'яви які є дублюючими. Це майже 40% від всієї кількості об'яв.

```sql
create view price_and_square_last as 
     select f.realty_id as realty_id,rt.realty_type as realty_type, adn.admin_district_name as district_name, f.total_price_USD as total_price_USD,
	 f.square_meter_price_USD as square_meter_price_USD, ph.total_square_meters, ph.rooms_count as rooms_count,
     yb.years_of_building asyears_of_building,f.E_oselya as E_oselya,f.credit as credit, ph.repair as repair
	     from financial_information f
	        join physical_characteristics ph
				on ph.realty_id = f.realty_id
	        join location l
				on l.realty_id = f.realty_id
            left join admin_district adn
				on adn.admin_district_ID = l.admin_district_ID
	        left join realty_type rt
                on f.realty_type_ID = rt.realty_type_ID
	        left join years_of_building yb
                on yb.years_building_ID = ph.years_building_ID
	 where f.original_or_copy = 'original' and l.city_id = 11
```
Також створюємо view в якому будуть вказані кількість переглядів, додавань, дата створення, та створемо стовпець , який буде характеризувати зацікавленість користувачів, коєфіцієнт зацікавленості. Ми отримуємо його поділивши кількість додавань на перегляди та помноживши на 100. Також враховуємо дату сворення об'яви, адже більш свіжі об'яви мають трохи інші показники в порівнянні зі сталими. Виділяємо 3 категорії "low" , "normal", "hight". Цей коефіцієнт є суб'єктивним, заснований на моєму власному досвіді, який варто доопрацьовувати, але він виконає основну задачу - відсіє "холодні" оголошення, які взагалі не цікаві користувачам. Завантажуємо данні з наших view у PowerBi, встановлюємо зв'язки та отримуємо наступний дашборд.

![image Alt Text](./vizualization/view.bmp)
---






